---
title: Java 集合概述
date: 2017-07-05 21:49:13
tags:
- Java
categories:
- Tech
---

实现方法时，选择不同的数据结构会使实现风格和性能有很大的差异。本篇文章讲述如何使用 Java 标准库中的集合类。





<!-- more -->





## 集合的接口

Java 集合类库将接口与实现分离，比如队列接口包含 add、remove、size 等方法，并没有说明队列是如何实现的。队列通常有两种实现方式：循环数组（ArrayDeque）和链表（LinkedList），每个实现都通过实现 Queue 接口的类表示。

使用集合时，通常使用接口类型存放集合的引用，只有在构建集合对象时才使用具体的类。一旦想要改变实现类，可以轻松地使用另一种不同的实现。

Java 中集合类的基本接口为 Collection，包含 add、iterator 等接口。add 方法用于向集合添加元素，如果确实改变了集合就返回 true；iterator 接口返回一个实现了 Iterator 接口的对象，可以使用这个对象一次访问集合中的元素。

Iterator 接口包含 next、hasNext、remove 等方法。反复调用 next 方法可以逐个访问集合中的元素（到达集合末尾抛异常）；hasNext 用于判断是否还有可供访问的元素；remove 方法将会删除上次调用 next 时返回的元素，如果要删除两个相邻的元素必须分别在调用 next 后调用 remove 方法。

使用 for each 循环可以更加简练地遍历元素，可以对任意实现了 Iterable 接口的对象使用 for each。Iterable 接口包含 iterator 方法。Collection 接口扩展了 Iterable 接口，所以标准库中的任何集合都可以使用 for each 循环。

List 是一个有序集合，可以采用迭代器访问或使用整数索引来随机访问，Java 1.4 引入一个不包含任何方法接口 RandomAccess 来标记是否支持高效的随机访问。

Set 相比于 Collection 有更严格的定义，add 方法不允许添加重复的数据。





## 具体的集合



### LinkedList

数组列表（ArrayList）在中间位置删除或插入元素时，被删除或插入的元素后面所有的元素都要移动，所以要付出很高的代价，LinkedList 通过将每个对象存放在单独的节点并保存相邻节点的引用来解决这个问题。

LinkedList.add 方法会将对象添加到链表的尾部，如果要将元素添加到链表的中间，可以通过迭代器来完成。另外LinkedList.listIterator 方法返回一个 ListIterator 对象，此对象的 add 方法没有返回值，假定添加操作都会改变链表，另外提供 previous 和 hasPrevious 方法来反向遍历链表。

如果迭代器发现它的集合被另一个迭代器修改了，会抛出异常。

尽管 LinkedList 提供了随机访问的方法，但每次访问需要从头开始，所以应该尽量避免。



### ArrayList

ArrayList 封装了一个动态数组，支持高效地随机访问。

在数组空间不够时创建新数组，并将旧数组中的数据拷贝到新数组中。

ArrayList 的方法不是同步的，只能在不需要同步时使用 ArrayList。



### HashSet

如果要查找链表或数组中某元素的位置，就需要遍历所有元素，直到找到为止，在集合包含大量元素时很耗时间。

散列表 HashMap 可以快速地查找需要的对象，Java 中用链表数组实现，每个列表称为桶。HashMap 计算元素的散列码 hash code，与桶的总数取余得到元素的桶索引，并将不同（equals 方法判断）的元素添加到链表中。

如果想更多地控制性能，可以指定初始的桶数，通常将桶数设置为预计元素个数的 75% ~ 150%。标准库使用的桶数为 2 的幂，默认为 16。

散列表填满到一定程度后会进行再散列，创建一个桶数为 2 倍的散列表并将所有的元素填入新表。填装因子 load factor 决定何时进行再散列，默认为 0.75（对大多应用都比较合理），即超过 75% 的位置填入元素就进行再散列。

HashSet 是基于 HashMap 的集合，通过 add 方法添加元素，contains 方法被重新定义，可以快速查看某个元素是否在集合中。

HashSet 在遍历时依次访问所有的桶，所以访问顺序集合是随机的，只有在不要求元素顺序时才使用 HashSet。



### TreeSet

TreeSet 和 HashSet 类似，不过 TreeSet 基于红黑树，是一个有序集，需要指定排序方式，在添加元素时会放置到正确排序的位置上。

添加元素到树集比添加到散列集慢，在不需要排序时就没必要付出排序的开销。



### HashMap

映射 Map 用来存放键值对，通过键可以找到值。

HashMap 对键进行散列，散列和比较函数仅作用于键。跟 TreeSet 相比，散列的性能更好一点。



### WeakHashMap

进行垃圾回收时只会检查对象是否存活，只要对象存活，所有的桶都存活，即 Map 中无用的值也不会被回收。

WeakHashMap 使用弱引用来保存键，在垃圾回收时只存在若引用的对象会被回收，放入一个若引用的队列，WeakHashMap 会周期性地检查队列，删除对应的条目。



### LinkedHashMap

LinkedHashSet 和 LinkedHashMap 通过维护一个双向链表来维护元素的顺序，默认为元素插入的顺序。如果将顺序设置为访问顺序，每次在调用 get 或 put 时，受影响的条目将从链表中删除，并放到链表的尾部。

